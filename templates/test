$(function() {
        navigator.geolocation.getCurrentPosition(function(position) {
            //console.log(position.coords);
            var map,
                myLatLng = new google.maps.LatLng(41.850033, -87.6500523),
                rendererOptions = {
                    draggable: true
                };
                directionsService = new google.maps.DirectionsService(),
                directionsRender = new google.maps.DirectionsRenderer(rendererOptions),
                image = 'images/images.jpg';

            var mapOptions = {
                zoom: 5,
                center: myLatLng,
                mapTypeId: google.maps.MapTypeId.HYBRID
            };

            map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);
            directionsRender.setMap(map);

            google.maps.event.addListener(directionsRender, 'directions_changed', function() {
                computeTotalDistance(directionsRender.directions);
            });


            calcRoute();
            function calcRoute() {

                var start = 'chicago, il';
                var end = 'st louis, mo';
                var request = {
                    origin: start,
                    destination: end,
                    travelMode: google.maps.TravelMode.DRIVING
                };
                directionsService.route(request, function (result, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        directionsRender.setDirections(result);
                    }
                });
            }

            function computeTotalDistance(result) {
                var total = 0;
                var myroute = result.routes[0];
                for (i = 0; i < myroute.legs.length; i++) {
                    total += myroute.legs[i].distance.value;
                }
                total = total / 1000.
                document.getElementById("total").innerHTML = total + " km";
            }
    });